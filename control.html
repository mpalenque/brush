<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Panel - Multi-Screen Wallpaper</title>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/control.css">
    
    <!-- OpenCV.js Configuration -->
    <script>
        // ConfiguraciÃ³n global para OpenCV
        function updateOpenCVStatus(message, type = 'normal') {
            const statusDiv = document.getElementById('opencvStatus');
            if (statusDiv) {
                statusDiv.textContent = message;
                statusDiv.className = `opencv-status ${type}`;
            }
        }
        
        function onOpenCvReady() {
            console.log('OpenCV.js is ready!');
            // La lÃ³gica principal estÃ¡ en opencv-processor.js
            if (window.onOpenCvReady) {
                window.onOpenCvReady();
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Multi-Screen Wallpaper Control</h1>
        
        <!-- Estado de ConexiÃ³n -->
        <div class="connection-status" id="connectionStatus">
            ğŸ”Œ Conectando al servidor...
        </div>

        <!-- SecciÃ³n OpenCV -->
        <div class="section opencv-section">
            <h2>ğŸ“· OpenCV - Procesamiento AutomÃ¡tico desde /captura</h2>
            
            <div id="opencvStatus" class="opencv-status">
                â³ Cargando OpenCV.js...
            </div>
            
            <div class="opencv-controls">
                <div class="opencv-input-area">
                    <h3>âš¡ Proceso AutomÃ¡tico</h3>
                    <div class="auto-process-info">
                        <p><strong>ğŸ“ Carpeta de origen:</strong> /captura</p>
                        <p><strong>ğŸ–¼ï¸ SelecciÃ³n de imagen:</strong> Teclas <kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd></p>
                        <p><strong>âŒ¨ï¸ ActivaciÃ³n del proceso:</strong> Presiona la tecla <kbd>9</kbd></p>
                        <p><strong>ğŸ”„ Proceso:</strong> Escaneo â†’ DetecciÃ³n â†’ Cropeo â†’ Filtrado â†’ Guardado</p>
                        <p><strong>ğŸ¨ Brush Reveal:</strong> AutomÃ¡ticamente colorea el nuevo patrÃ³n por encima</p>
                    </div>
                    
                    <div class="image-selection-info">
                        <h4>ğŸ–¼ï¸ Imagen Seleccionada:</h4>
                        <div class="selected-image-display">
                            <span id="selectedImageName">red.png</span>
                            <div class="image-buttons">
                                <button class="image-btn selected" data-image="red">ğŸ”´ Red (1)</button>
                                <button class="image-btn" data-image="pink">ğŸŒ¸ Pink (2)</button>
                                <button class="image-btn" data-image="blue">ğŸ”µ Blue (3)</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="process-status" id="processStatus">
                        ğŸ” Selecciona imagen (1-3) y presiona "9" para escanear /captura, procesar y enviar a Brush Reveal
                    </div>

                    <!-- Estado actual: vista rÃ¡pida de imagen elegida y Ãºltimo patrÃ³n aplicado -->
                    <div class="status-widget" id="statusWidget">
                        <h4>ğŸ“Œ Estado actual</h4>
                        <div class="status-row">
                            <div class="status-item">
                                <div class="status-label">Imagen elegida</div>
                                <img id="selectedImageThumb" class="status-thumb" alt="Imagen seleccionada" />
                            </div>
                            <div class="status-item">
                                <div class="status-label">Ãšltimo pattern aplicado</div>
                                <img id="patternPreviewThumb" class="status-thumb" alt="Pattern aplicado" />
                                <div class="status-timestamp">Actualizado: <span id="patternLastUpdated">â€”</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <img id="imagePreview" class="image-preview-small" style="display: none;" alt="Vista previa">
                    
                    <details class="detection-parameters" id="detectionParams">
                        <summary class="detection-summary">âš™ï¸ ParÃ¡metros de DetecciÃ³n y Cropeo</summary>
                        <div class="parameters-content">
                            <div class="control-group">
                                <label for="thresholdValue">ğŸ¯ Umbral de DetecciÃ³n: <span id="thresholdDisplay" class="range-display">200</span></label>
                                <input type="range" id="thresholdValue" min="50" max="255" value="200">
                            </div>
                            
                            <div class="control-group">
                                <label for="minAreaValue">ğŸ“ Ãrea MÃ­nima: <span id="minAreaDisplay" class="range-display">1000</span></label>
                                <input type="range" id="minAreaValue" min="500" max="5000" value="1000">
                            </div>
                            
                            <div class="control-group">
                                <label for="epsilonValue">ğŸ”§ PrecisiÃ³n Epsilon: <span id="epsilonDisplay" class="range-display">0.020</span></label>
                                <input type="range" id="epsilonValue" min="0.005" max="0.1" step="0.005" value="0.02">
                            </div>
                            
                            <div class="control-group">
                                <label for="aspectRatioTolerance">ğŸ“ Tolerancia Aspecto: <span id="aspectRatioDisplay" class="range-display">2.0</span></label>
                                <input type="range" id="aspectRatioTolerance" min="1.0" max="5.0" step="0.1" value="2.0">
                            </div>
                            
                            <button id="manualProcessButton" class="process-button" onclick="manualProcessFromCaptura()" disabled>
                                ğŸ”„ Procesar Manualmente desde /captura (Tecla 9)
                            </button>
                        </div>
                    </details>
                </div>
                
                <div class="opencv-output-area">
                    <h3>ğŸ“Š Resultados</h3>
                    
                    <div class="result-container-small">
                        <h4>ğŸ¯ DetecciÃ³n</h4>
                        <canvas id="detectionCanvas" class="result-canvas-small"></canvas>
                    </div>
                    
                    <div class="result-container-small">
                        <h4>âœ… Imagen Corregida</h4>
                        <canvas id="correctedCanvas" class="result-canvas-small"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ConfiguraciÃ³n General -->
        <div class="section">
            <h2>âš™ï¸ ConfiguraciÃ³n General</h2>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="patternType">ğŸ¨ Tipo de PatrÃ³n:</label>
                    <select id="patternType">
                        <option value="organic-complex">OrgÃ¡nico Complejo</option>
                        <option value="grid">CuadrÃ­cula</option>
                        <option value="brick">Ladrillo</option>
                        <option value="hexagon">HexÃ¡gono</option>
                        <option value="diamond">Diamante</option>
                        <option value="mirror-horizontal">Espejo Horizontal</option>
                        <option value="mirror-vertical">Espejo Vertical</option>
                        <option value="mirror-both">Espejo Ambos</option>
                        <option value="rotate-90">RotaciÃ³n 90Â°</option>
                        <option value="rotate-180">RotaciÃ³n 180Â°</option>
                        <option value="rotate-mixed">RotaciÃ³n Mixta</option>
                        <option value="scale-varied">Escala Variada</option>
                        <option value="alternating-scale">Escala Alternada</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="repetitionX">ğŸ”„ Repeticiones X: <span id="repetitionXValue" class="range-display">200</span></label>
                    <input type="range" id="repetitionX" min="1" max="500" value="200">
                </div>

                <div class="control-group">
                    <label for="repetitionY">ğŸ”„ Repeticiones Y: <span id="repetitionYValue" class="range-display">8</span></label>
                    <input type="range" id="repetitionY" min="1" max="25" value="8">
                </div>

                <div class="control-group">
                    <label for="separationX">â†”ï¸ SeparaciÃ³n X: <span id="separationXValue" class="range-display">300px</span></label>
                    <input type="range" id="separationX" min="50" max="1000" value="300">
                </div>

                <div class="control-group">
                    <label for="patternSize">ğŸ“ TamaÃ±o del PatrÃ³n: <span id="sizeValue" class="range-display">300px</span></label>
                    <input type="range" id="patternSize" min="50" max="500" value="300">
                </div>

                <div class="control-group">
                    <label for="rotation">ğŸ”„ RotaciÃ³n: <span id="rotationValue" class="range-display">0Â°</span></label>
                    <input type="range" id="rotation" min="0" max="360" value="0">
                </div>

                <div class="control-group">
                    <label for="zoom">ğŸ” Zoom: <span id="zoomValue" class="range-display">230%</span></label>
                    <input type="range" id="zoom" min="0.5" max="5" step="0.1" value="2.3">
                </div>

                <div class="control-group">
                    <label for="perfumeSpacingH">â†”ï¸ Espaciado H Perfume: <span id="perfumeSpacingHValue" class="range-display">0.45Ã—</span></label>
                    <input type="range" id="perfumeSpacingH" min="0.1" max="2.0" step="0.05" value="0.45">
                </div>

                <div class="control-group">
                    <label for="perfumeSpacingV">â†•ï¸ Espaciado V Perfume: <span id="perfumeSpacingVValue" class="range-display">0.70Ã—</span></label>
                    <input type="range" id="perfumeSpacingV" min="0.1" max="2.0" step="0.05" value="0.7">
                </div>

                <div class="control-group">
                    <label for="perfumeSizeFactor">ğŸ“ TamaÃ±o Perfume: <span id="perfumeSizeFactorValue" class="range-display">85%</span></label>
                    <input type="range" id="perfumeSizeFactor" min="0.3" max="2.0" step="0.05" value="0.85">
                </div>

                <div class="control-group">
                    <label for="backgroundColor">ğŸ¨ Color de Fondo: <span id="backgroundRgb" class="range-display">RGB: 245, 221, 199</span></label>
                    <input type="color" id="backgroundColor" value="#F5DDC7">
                </div>
            </div>
        </div>

        <!-- Control de Offsets de Pantallas -->
        <div class="section">
            <h2>ğŸ–¥ï¸ Ajuste Manual de Offsets</h2>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                Ajusta manualmente el offset horizontal de cada pantalla. 
                Los valores negativos mueven el patrÃ³n hacia la izquierda.
            </p>
            <div class="screens-offset-grid" id="offsetControls">
                <!-- Controles de offset para cada pantalla -->
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 1:</label>
                    <input type="range" id="offset1" min="-5000" max="5000" value="0" step="10">
                    <span id="offset1Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 2:</label>
                    <input type="range" id="offset2" min="-5000" max="5000" value="0" step="10">
                    <span id="offset2Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 3:</label>
                    <input type="range" id="offset3" min="-5000" max="5000" value="0" step="10">
                    <span id="offset3Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 4:</label>
                    <input type="range" id="offset4" min="-5000" max="5000" value="0" step="10">
                    <span id="offset4Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 5:</label>
                    <input type="range" id="offset5" min="-5000" max="5000" value="0" step="10">
                    <span id="offset5Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 6:</label>
                    <input type="range" id="offset6" min="-5000" max="5000" value="0" step="10">
                    <span id="offset6Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 7:</label>
                    <input type="range" id="offset7" min="-5000" max="5000" value="0" step="10">
                    <span id="offset7Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 8:</label>
                    <input type="range" id="offset8" min="-5000" max="5000" value="0" step="10">
                    <span id="offset8Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 9:</label>
                    <input type="range" id="offset9" min="-5000" max="5000" value="0" step="10">
                    <span id="offset9Value" class="offset-value">0px</span>
                </div>
            </div>
            <div class="offset-buttons" style="margin-top: 15px;">
                <button onclick="zeroAllOffsets()" style="background-color: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    âŒ Poner Todos en 0
                </button>
            </div>
        </div>

        <!-- Abrir Pantallas -->
        <div class="section">
            <h2>ğŸš€ Abrir Pantallas en Nuevas PestaÃ±as</h2>
            <div class="screens-grid-3x3" id="screensGrid">
                <!-- Las pantallas se generarÃ¡n dinÃ¡micamente en grilla 3x3 -->
            </div>
            <div style="margin-top: 15px;">
                <button onclick="openAllScreens()" style="background-color: #28a745; font-size: 16px; font-weight: bold; width: 100%; padding: 15px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                    ğŸ–¥ï¸ Abrir TODAS las Pantallas (1-9)
                </button>
            </div>
            <div style="margin-top: 10px;">
                <button onclick="openBrushReveal()" style="background-color: #6f42c1; font-size: 16px; font-weight: bold; width: 100%; padding: 15px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                    ğŸ¨ Abrir Brush Reveal
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="assets/js/opencv-processor.js"></script>
    <script src="assets/js/control.js"></script>
</body>
</html>
