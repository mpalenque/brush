<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Panel - Multi-Screen Wallpaper</title>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/control.css">
    

</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Multi-Screen Wallpaper Control</h1>
        
        <!-- Estado de ConexiÃ³n -->
        <div class="connection-status" id="connectionStatus">
            ğŸ”Œ Conectando al servidor...
        </div>

        <!-- Atajos de Teclado -->
        <div class="section" style="background: #e8f4fd; border-left: 4px solid #007bff;">
            <h2>âŒ¨ï¸ Atajos de Teclado</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 14px;">
                <div><strong>Tecla 1:</strong> Capturar screen/1 â†’ guardar wallpaper.jpg y mostrarlo</div>
                <div><strong>Tecla A:</strong> Cambiar imagen a rosa (no captura wallpaper)</div>
                <div><strong>Tecla Z:</strong> Seleccionar imagen roja</div>
                <div><strong>Tecla Q:</strong> Seleccionar imagen azul</div>
                <div><strong>Tecla 9:</strong> Procesar desde captura</div>
                <div><strong>Tecla P:</strong> Cambiar a fuente procesada</div>
            </div>
            <div style="margin-top: 10px; padding: 8px; background: #d4edda; border-radius: 4px; border-left: 3px solid #28a745;">
                <strong>ğŸ–Œï¸ Coloreo Directo:</strong> Usa "Iniciar Coloreado" para colorear automÃ¡ticamente cada 40s rotando entre amarillo.jpg, rojo.jpg y azul.jpg sin depender del wallpaper grabado.
            </div>
            <small style="color:#666; display: block; margin-top: 8px;">
                â° <strong>Auto-rotaciÃ³n:</strong> DespuÃ©s de 2 minutos sin actividad, se inicia automÃ¡ticamente la rotaciÃ³n entre amarillo.jpg, rojo.jpg y azul.jpg cada minuto.
            </small>
        </div>

        <!-- ConfiguraciÃ³n General -->
        <div class="section">
            <h2>âš™ï¸ ConfiguraciÃ³n General</h2>
            <div class="control-group" style="margin-bottom:12px;">
                <label>ğŸ§© Fuente del PatrÃ³n (pantallas):</label>
                <div class="image-buttons">
                    <button class="image-btn pattern-source-btn selected" data-source="processed">ğŸ§ª Procesado (P)</button>
                </div>
                <small style="color:#666;">Las pantallas cargarÃ¡n desde la imagen procesada.</small>
            </div>
            
            <!-- RotaciÃ³n automÃ¡tica siempre activa por defecto; controles removidos para simplificar UI -->
            
            <!-- Controles de Coloreado AutomÃ¡tico -->
            <div class="control-group" style="margin-bottom:12px; border: 2px solid #28a745; border-radius: 8px; padding: 15px; background: #f8fff9;">
                <label style="font-weight: bold; color: #28a745;">ğŸ¨ Control de Coloreado AutomÃ¡tico:</label>
                <div class="color-sequence-controls" style="display: flex; gap: 10px; margin: 10px 0; flex-wrap: wrap;">
                    <button id="startColorSequenceBtn" class="image-btn" style="background: #28a745; color: white;">
                        â–¶ï¸ Iniciar Coloreado
                    </button>
                    <button id="stopColorSequenceBtn" class="image-btn" style="background: #dc3545; color: white;">
                        â¹ï¸ Detener Coloreado
                    </button>
                    <button id="nextColorBtn" class="image-btn" style="background: #17a2b8; color: white;">
                        â­ï¸ Siguiente Color
                    </button>
                    <button id="resetColorBtn" class="image-btn" style="background: #ffc107; color: black;">
                        ğŸ”„ Reset a Amarillo
                    </button>
                    <button id="switchModeBtn" class="image-btn" style="background: #6f42c1; color: white;" data-mode="sequence">
                        ğŸ”€ SWITCH a Wallpaper
                    </button>
                </div>
                <div class="color-sequence-status" id="colorSequenceStatus" style="margin-top: 8px; font-size: 12px; color: #666; font-weight: bold;">
                    ğŸŸ¡ Fondo: amarillo.jpg | Modo: Secuencia (rojoâ†’azulâ†’amarillo)
                </div>
                <small style="color:#666;">
                    <strong>Modo Secuencia:</strong> rojo.jpg â†’ azul.jpg â†’ amarillo.jpg encima del fondo (cada 40s despuÃ©s de terminar).
                    <br><strong>Modo Wallpaper:</strong> Colorea con wallpaper.jpg procesado desde screen/1 y luego vuelve a Secuencia.
                    <br><strong>SWITCH:</strong> Alterna entre los dos modos de coloreado.
                </small>
            </div>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="patternType">ğŸ¨ Tipo de PatrÃ³n:</label>
                    <select id="patternType">
                        <option value="organic-complex">OrgÃ¡nico Complejo</option>
                        <option value="grid">CuadrÃ­cula</option>
                        <option value="brick">Ladrillo</option>
                        <option value="hexagon">HexÃ¡gono</option>
                        <option value="diamond">Diamante</option>
                        <option value="mirror-horizontal">Espejo Horizontal</option>
                        <option value="mirror-vertical">Espejo Vertical</option>
                        <option value="mirror-both">Espejo Ambos</option>
                        <option value="rotate-90">RotaciÃ³n 90Â°</option>
                        <option value="rotate-180">RotaciÃ³n 180Â°</option>
                        <option value="rotate-mixed">RotaciÃ³n Mixta</option>
                        <option value="scale-varied">Escala Variada</option>
                        <option value="alternating-scale">Escala Alternada</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="repetitionX">ğŸ”„ Repeticiones X: <span id="repetitionXValue" class="range-display">265</span></label>
                    <input type="range" id="repetitionX" min="1" max="500" value="265">
                </div>

                <div class="control-group">
                    <label for="repetitionY">ğŸ”„ Repeticiones Y: <span id="repetitionYValue" class="range-display">23</span></label>
                    <input type="range" id="repetitionY" min="1" max="25" value="23">
                </div>

                <div class="control-group">
                    <label for="separationX">â†”ï¸ SeparaciÃ³n X: <span id="separationXValue" class="range-display">80px</span></label>
                    <input type="range" id="separationX" min="50" max="1000" value="80">
                </div>

                <div class="control-group">
                    <label for="separationY">â†•ï¸ SeparaciÃ³n Y: <span id="separationYValue" class="range-display">119px</span></label>
                    <input type="range" id="separationY" min="50" max="1000" value="119">
                </div>

                <div class="control-group">
                    <label for="spacingX">ğŸ“ Espaciado PatrÃ³n X: <span id="spacingXValue" class="range-display">0px</span></label>
                    <input type="range" id="spacingX" min="0" max="500" value="0">
                </div>

                <div class="control-group">
                    <label for="spacingY">ğŸ“ Espaciado PatrÃ³n Y: <span id="spacingYValue" class="range-display">0px</span></label>
                    <input type="range" id="spacingY" min="0" max="500" value="0">
                </div>

                <div class="control-group">
                    <label for="patternSize">ğŸ“ TamaÃ±o del PatrÃ³n: <span id="sizeValue" class="range-display">300px</span></label>
                    <input type="range" id="patternSize" min="50" max="1000" value="300">
                </div>

                <div class="control-group">
                    <label for="rotation">ğŸ”„ RotaciÃ³n: <span id="rotationValue" class="range-display">0Â°</span></label>
                    <input type="range" id="rotation" min="0" max="360" value="0">
                </div>

                <div class="control-group">
                    <label for="zoom">ğŸ” Zoom: <span id="zoomValue" class="range-display">230%</span></label>
                    <input type="range" id="zoom" min="0.5" max="5" step="0.1" value="2.3">
                </div>

                <div class="control-group">
                    <label for="perfumeSpacingH">â†”ï¸ Espaciado H ImÃ¡genes: <span id="perfumeSpacingHValue" class="range-display">0.25Ã—</span></label>
                    <input type="range" id="perfumeSpacingH" min="0.1" max="2.0" step="0.05" value="0.25">
                </div>

                <div class="control-group">
                    <label for="perfumeSpacingV">â†•ï¸ Espaciado V ImÃ¡genes: <span id="perfumeSpacingVValue" class="range-display">0.30Ã—</span></label>
                    <input type="range" id="perfumeSpacingV" min="0.1" max="2.0" step="0.05" value="0.30">
                </div>

                <div class="control-group">
                    <label for="perfumeSizeFactor">ğŸ“ Escala ImÃ¡genes: <span id="perfumeSizeFactorValue" class="range-display">55%</span></label>
                    <input type="range" id="perfumeSizeFactor" min="0.3" max="2.0" step="0.05" value="0.55">
                </div>

                <div class="control-group">
                    <label for="backgroundColor">ğŸ¨ Color de Fondo: <span id="backgroundRgb" class="range-display">RGB: 255, 242, 229</span></label>
                    <input type="color" id="backgroundColor" value="#FFF2E5">
                </div>
            </div>
        </div>

        <!-- Control de ImÃ¡genes Superpuestas -->
        <div class="section">
            <h2>ğŸ–¼ï¸ Control de ImÃ¡genes Superpuestas</h2>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                Controla la cantidad, posiciÃ³n y tamaÃ±o de las imÃ¡genes superpuestas (blue.png, red.png, pink.png) que se muestran encima del patrÃ³n.
            </p>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="overlayCountX">ğŸ”¢ Cantidad X: <span id="overlayCountXValue" class="range-display">10</span></label>
                    <input type="range" id="overlayCountX" min="1" max="10" value="10">
                </div>

                <div class="control-group">
                    <label for="overlayCountY">ğŸ”¢ Cantidad Y: <span id="overlayCountYValue" class="range-display">8</span></label>
                    <input type="range" id="overlayCountY" min="1" max="8" value="8">
                </div>

                <div class="control-group">
                    <label for="overlayOffsetX">â†”ï¸ Offset X: <span id="overlayOffsetXValue" class="range-display">-550px</span></label>
                    <input type="range" id="overlayOffsetX" min="-2000" max="2000" value="-550" step="50">
                </div>

                <div class="control-group">
                    <label for="overlayOffsetY">â†•ï¸ Offset Y: <span id="overlayOffsetYValue" class="range-display">-150px</span></label>
                    <input type="range" id="overlayOffsetY" min="-2000" max="2000" value="-150" step="50">
                </div>

                <div class="control-group">
                    <label for="overlaySize">ğŸ“ TamaÃ±o: <span id="overlaySizeValue" class="range-display">192px</span></label>
                    <input type="range" id="overlaySize" min="50" max="500" value="192">
                </div>

                <div class="control-group">
                    <label for="overlaySpacingX">â†”ï¸ Espaciado X: <span id="overlaySpacingXValue" class="range-display">400px</span></label>
                    <input type="range" id="overlaySpacingX" min="200" max="2000" value="400" step="50">
                </div>

                <div class="control-group">
                    <label for="overlaySpacingY">â†•ï¸ Espaciado Y: <span id="overlaySpacingYValue" class="range-display">250px</span></label>
                    <input type="range" id="overlaySpacingY" min="200" max="1500" value="250" step="50">
                </div>

                <div class="control-group">
                    <label for="overlayRowOffsetX">ğŸ”€ Desfase Filas X: <span id="overlayRowOffsetXValue" class="range-display">60px</span></label>
                    <input type="range" id="overlayRowOffsetX" min="-500" max="500" value="60" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayRowOffsetY">ğŸ”€ Desfase Filas Y: <span id="overlayRowOffsetYValue" class="range-display">0px</span></label>
                    <input type="range" id="overlayRowOffsetY" min="-500" max="500" value="0" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayColOffsetX">ğŸ”€ Desfase Columnas X: <span id="overlayColOffsetXValue" class="range-display">0px</span></label>
                    <input type="range" id="overlayColOffsetX" min="-500" max="500" value="0" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayColOffsetY">ğŸ”€ Desfase Columnas Y: <span id="overlayColOffsetYValue" class="range-display">0px</span></label>
                    <input type="range" id="overlayColOffsetY" min="-500" max="500" value="0" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayAlternateRowX">ğŸ”„ Filas Alternas X: <span id="overlayAlternateRowXValue" class="range-display">140px</span></label>
                    <input type="range" id="overlayAlternateRowX" min="-1000" max="1000" value="140" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayAlternateRowY">ğŸ”„ Filas Alternas Y: <span id="overlayAlternateRowYValue" class="range-display">0px</span></label>
                    <input type="range" id="overlayAlternateRowY" min="-1000" max="1000" value="0" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayAlternateColX">ğŸ”„ Columnas Alternas X: <span id="overlayAlternateColXValue" class="range-display">0px</span></label>
                    <input type="range" id="overlayAlternateColX" min="-1000" max="1000" value="0" step="10">
                </div>

                <div class="control-group">
                    <label for="overlayAlternateColY">ğŸ”„ Columnas Alternas Y: <span id="overlayAlternateColYValue" class="range-display">0px</span></label>
                    <input type="range" id="overlayAlternateColY" min="-1000" max="1000" value="0" step="10">
                </div>

                <div class="control-group">
                    <label>ğŸ¨ Seleccionar Imagen:</label>
                    <div class="image-buttons">
                        <button class="image-btn overlay-image-btn selected" data-image="red">ğŸ”´ Roja</button>
                        <button class="image-btn overlay-image-btn" data-image="blue">ğŸ”µ Azul</button>
                        <button class="image-btn overlay-image-btn" data-image="pink">ğŸ©· Rosa</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control de Offsets de Pantallas -->
        <div class="section">
            <h2>ğŸ–¥ï¸ Ajuste Manual de Offsets</h2>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                Ajusta manualmente el offset horizontal de cada pantalla. 
                Los valores negativos mueven el patrÃ³n hacia la izquierda.
            </p>
            <div class="screens-offset-grid" id="offsetControls">
                <!-- Controles de offset para cada pantalla -->
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 1:</label>
                    <input type="range" id="offset1" min="-5000" max="5000" value="0" step="10">
                    <span id="offset1Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 2:</label>
                    <input type="range" id="offset2" min="-5000" max="5000" value="0" step="10">
                    <span id="offset2Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 3:</label>
                    <input type="range" id="offset3" min="-5000" max="5000" value="0" step="10">
                    <span id="offset3Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 4:</label>
                    <input type="range" id="offset4" min="-5000" max="5000" value="0" step="10">
                    <span id="offset4Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 5:</label>
                    <input type="range" id="offset5" min="-5000" max="5000" value="0" step="10">
                    <span id="offset5Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 6:</label>
                    <input type="range" id="offset6" min="-5000" max="5000" value="0" step="10">
                    <span id="offset6Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 7:</label>
                    <input type="range" id="offset7" min="-5000" max="5000" value="0" step="10">
                    <span id="offset7Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 8:</label>
                    <input type="range" id="offset8" min="-5000" max="5000" value="0" step="10">
                    <span id="offset8Value" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ–¥ï¸ Pantalla 9:</label>
                    <input type="range" id="offset9" min="-5000" max="5000" value="0" step="10">
                    <span id="offset9Value" class="offset-value">0px</span>
                </div>
            </div>
            <div class="offset-buttons" style="margin-top: 15px;">
                <button onclick="zeroAllOffsets()" style="background-color: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    âŒ Poner Todos en 0
                </button>
            </div>
        </div>

        <!-- ConfiguraciÃ³n Brush Reveal -->
        <div class="section">
            <h2>ğŸ¨ ConfiguraciÃ³n Brush Reveal (Secciones Wallpaper)</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Controla las secciones del wallpaper.jpg (6480x3840) que usa cada brush-reveal.<br>
                Cada secciÃ³n es de 2160x3840 pixels. Accede a: /brush-reveal/1, /brush-reveal/2, etc.
            </p>
            <div class="offset-grid">
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 1 - Offset X:</label>
                    <input type="range" id="brushOffset1X" min="0" max="4320" value="0" step="2160">
                    <span id="brushOffset1XValue" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 2 - Offset X:</label>
                    <input type="range" id="brushOffset2X" min="0" max="4320" value="2160" step="2160">
                    <span id="brushOffset2XValue" class="offset-value">2160px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 3 - Offset X:</label>
                    <input type="range" id="brushOffset3X" min="0" max="4320" value="4320" step="2160">
                    <span id="brushOffset3XValue" class="offset-value">4320px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 4 - Offset X:</label>
                    <input type="range" id="brushOffset4X" min="0" max="4320" value="0" step="2160">
                    <span id="brushOffset4XValue" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 5 - Offset X:</label>
                    <input type="range" id="brushOffset5X" min="0" max="4320" value="2160" step="2160">
                    <span id="brushOffset5XValue" class="offset-value">2160px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 6 - Offset X:</label>
                    <input type="range" id="brushOffset6X" min="0" max="4320" value="4320" step="2160">
                    <span id="brushOffset6XValue" class="offset-value">4320px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 7 - Offset X:</label>
                    <input type="range" id="brushOffset7X" min="0" max="4320" value="0" step="2160">
                    <span id="brushOffset7XValue" class="offset-value">0px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 8 - Offset X:</label>
                    <input type="range" id="brushOffset8X" min="0" max="4320" value="2160" step="2160">
                    <span id="brushOffset8XValue" class="offset-value">2160px</span>
                </div>
                <div class="offset-control-group">
                    <label>ğŸ¨ Brush 9 - Offset X:</label>
                    <input type="range" id="brushOffset9X" min="0" max="4320" value="4320" step="2160">
                    <span id="brushOffset9XValue" class="offset-value">4320px</span>
                </div>
            </div>
            <div class="offset-buttons" style="margin-top: 15px;">
                <button onclick="openAllBrushReveals()" style="background-color: #6f42c1; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                    ğŸ¨ Abrir Todos los Brush Reveals
                </button>
                <button onclick="resetBrushOffsets()" style="background-color: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    â†º Resetear Offsets
                </button>
            </div>
        </div>

        <!-- ConfiguraciÃ³n Slideshow -->
        <div class="section">
            <h2>ğŸ“º ConfiguraciÃ³n Slideshow (Brush 3 y 7)</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Control del slideshow superpuesto en brush-reveal/3 y brush-reveal/7.<br>
                Las imÃ¡genes se cargan desde las carpetas slideshow/3 y slideshow/4 respectivamente.<br>
                <strong>PosiciÃ³n X:</strong> 0-2160px (ancho de la secciÃ³n brush) | <strong>PosiciÃ³n Y:</strong> 0-3840px (alto de la secciÃ³n)<br>
                <strong>TamaÃ±o:</strong> Controla el tamaÃ±o real del cuadrado del slideshow (50px-2000px para doble escala)
            </p>
            
            <!-- Slideshow para Brush 3 -->
            <div class="slideshow-config">
        <h3>ğŸ“º Slideshow Brush 3 (Carpeta: slideshow/3)</h3>
                <div class="controls-grid">
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="slideshow3Enabled" checked> Activar Slideshow Brush 3
                        </label>
                    </div>
                    <div class="control-group">
            <label for="slideshow3Width">Ancho: <span id="slideshow3WidthValue" class="range-display">865px</span></label>
            <input type="range" id="slideshow3Width" min="50" max="2000" value="865">
                    </div>
                    <div class="control-group">
            <label for="slideshow3Height">Alto: <span id="slideshow3HeightValue" class="range-display">972px</span></label>
            <input type="range" id="slideshow3Height" min="50" max="2000" value="972">
                    </div>
                    <div class="control-group">
            <label for="slideshow3X">PosiciÃ³n X: <span id="slideshow3XValue" class="range-display">102px</span></label>
            <input type="range" id="slideshow3X" min="0" max="2160" value="102">
                    </div>
                    <div class="control-group">
            <label for="slideshow3Y">PosiciÃ³n Y: <span id="slideshow3YValue" class="range-display">153px</span></label>
            <input type="range" id="slideshow3Y" min="0" max="3840" value="153">
                    </div>
                    <div class="control-group">
                        <label for="slideshow3Interval">Intervalo: <span id="slideshow3IntervalValue" class="range-display">3000ms</span></label>
                        <input type="range" id="slideshow3Interval" min="1000" max="10000" value="3000" step="500">
                    </div>
                    <div class="control-group">
                        <label for="slideshow3ShadowWidth">ğŸŒ‘ Ancho Sombra: <span id="slideshow3ShadowWidthValue" class="range-display">20px</span></label>
                        <input type="range" id="slideshow3ShadowWidth" min="0" max="100" value="20" step="5">
                    </div>
                </div>
            </div>

            <!-- Slideshow para Brush 7 -->
            <div class="slideshow-config" style="margin-top: 20px;">
                <h3>ğŸ“º Slideshow Brush 7 (Carpeta: slideshow/4)</h3>
                <div class="controls-grid">
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="slideshow7Enabled" checked> Activar Slideshow Brush 7
                        </label>
                    </div>
                    <div class="control-group">
                        <label for="slideshow7Width">Ancho: <span id="slideshow7WidthValue" class="range-display">1670px</span></label>
                        <input type="range" id="slideshow7Width" min="50" max="2000" value="1670">
                    </div>
                    <div class="control-group">
                        <label for="slideshow7Height">Alto: <span id="slideshow7HeightValue" class="range-display">1912px</span></label>
                        <input type="range" id="slideshow7Height" min="50" max="2000" value="1912">
                    </div>
                    <div class="control-group">
                        <label for="slideshow7X">PosiciÃ³n X: <span id="slideshow7XValue" class="range-display">256px</span></label>
                        <input type="range" id="slideshow7X" min="0" max="2160" value="256">
                    </div>
                    <div class="control-group">
                        <label for="slideshow7Y">PosiciÃ³n Y: <span id="slideshow7YValue" class="range-display">300px</span></label>
                        <input type="range" id="slideshow7Y" min="0" max="3840" value="300">
                    </div>
                    <div class="control-group">
                        <label for="slideshow7Interval">Intervalo: <span id="slideshow7IntervalValue" class="range-display">3000ms</span></label>
                        <input type="range" id="slideshow7Interval" min="1000" max="10000" value="3000" step="500">
                    </div>
                    <div class="control-group">
                        <label for="slideshow7ShadowWidth">ğŸŒ‘ Ancho Sombra: <span id="slideshow7ShadowWidthValue" class="range-display">20px</span></label>
                        <input type="range" id="slideshow7ShadowWidth" min="0" max="100" value="20" step="5">
                    </div>
                </div>
            </div>
        </div>

        <!-- Abrir Pantallas -->
        <div class="section">
            <h2>ğŸš€ Abrir Pantallas en Nuevas PestaÃ±as</h2>
            <div class="screens-grid-3x3" id="screensGrid">
                <!-- Las pantallas se generarÃ¡n dinÃ¡micamente en grilla 3x3 -->
            </div>
            <div style="margin-top: 15px;">
                <button onclick="openAllScreens()" style="background-color: #28a745; font-size: 16px; font-weight: bold; width: 100%; padding: 15px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                    ğŸ–¥ï¸ Abrir TODAS las Pantallas (1-9)
                </button>
            </div>
            <div style="margin-top: 10px;">
                <button onclick="openBrushReveal()" style="background-color: #6f42c1; font-size: 16px; font-weight: bold; width: 100%; padding: 15px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                    ğŸ¨ Abrir Brush Reveal
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Sistema de conexiÃ³n mejorado - sin reloads constantes
        let connectionCheckCount = 0;
        let maxDisconnectionChecks = 3;
        
        function ensureControlConnection() {
            if (!window.socket) {
                // Socket aÃºn no inicializado
                return;
            }
            
            if (window.socket.disconnected) {
                connectionCheckCount++;
                console.log(`âš ï¸ Control: ConexiÃ³n perdida (${connectionCheckCount}/${maxDisconnectionChecks})`);
                
                // Solo recargar despuÃ©s de mÃºltiples checks fallidos
                if (connectionCheckCount >= maxDisconnectionChecks) {
                    console.log('ğŸ”„ Control: Reconectando despuÃ©s de mÃºltiples intentos fallidos...');
                    location.reload();
                }
            } else {
                connectionCheckCount = 0;
                console.log('âœ… Control: ConexiÃ³n al servidor activa');
            }
        }
        
        // Verificar conexiÃ³n cada 10 segundos (menos frecuente)
        const connectionCheckInterval = setInterval(ensureControlConnection, 10000);
        
        // Sistema de rotaciÃ³n automÃ¡tica de imÃ¡genes para Brush Reveal
        let autoRotationActive = false;
        
        function toggleAutoRotation() {
            // Delegar a la implementaciÃ³n central en assets/js/control.js
            if (window.toggleAutoRotation) {
                return window.toggleAutoRotation();
            }
            console.error('âŒ toggleAutoRotation global no disponible');
        }

        // Asegura que la rotaciÃ³n estÃ© corriendo (ON) sin requerir clic manual
        function ensureAutoRotationRunning() {
            // Deshabilitado para evitar conflictos de doble toggle
            return;
        }
        
        // Agregar event listener al botÃ³n cuando el DOM estÃ© listo
        document.addEventListener('DOMContentLoaded', function() {
            const autoRotationBtn = document.getElementById('autoRotationBtn');
            if (autoRotationBtn && !autoRotationBtn.dataset.handlerAttached) {
                autoRotationBtn.addEventListener('click', () => {
                    if (window.toggleAutoRotation) window.toggleAutoRotation();
                });
                autoRotationBtn.dataset.handlerAttached = 'true';
            }
            // No forzar auto-rotaciÃ³n al cargar para evitar toggles duplicados antes de que el socket estÃ© listo
            // Inicializar controles de slideshow
            initializeSlideshowControls();
            
            // NUEVO: Escuchar cuando las animaciones de brush-reveal terminan
            // Configurar listener cuando el socket estÃ© conectado
            function setupAnimationCompletedListener() {
                if (window.socket && window.socket.connected) {
                    window.socket.on('animationCompleted', (data) => {
                        console.log(`âœ… *** CONTROL *** AnimaciÃ³n completada en brush ${data.brushId} - reanudando auto-rotaciÃ³n`);
                        // Solo reanudar si no estamos en modo "A" activo
                        if (rotationActive) {
                            setTimeout(() => {
                                ensureAutoRotationRunning();
                            }, 1000); // pequeÃ±a pausa antes de reanudar
                        }
                    });
                    console.log('ğŸ‘‚ *** CONTROL *** Listener animationCompleted configurado');
                } else {
                    // Reintentar despuÃ©s de un momento
                    setTimeout(setupAnimationCompletedListener, 1000);
                }
            }
            
            // Iniciar configuraciÃ³n del listener
            setupAnimationCompletedListener();
        });
        
        // --- MODO ROTACIÃ“N SIEMPRE ACTIVO, INTERRUPCIONES POR 'A' ---
        let rotationActive = true;
        let lastAReceived = Date.now();
        let rotationTimeoutMinutes = 3; // default
        let rotationTimeoutId = null;

        // UI: Agregar input para ajustar tiempo de espera
        document.addEventListener('DOMContentLoaded', function() {
            const timeoutDiv = document.createElement('div');
            timeoutDiv.style = 'margin: 10px 0;';
            timeoutDiv.innerHTML = '<label for="rotationTimeoutInput">â±ï¸ Tiempo de espera para volver a rotaciÃ³n (min): </label>' +
                '<input id="rotationTimeoutInput" type="number" min="1" max="30" value="3" style="width: 60px;">';
            document.body.insertBefore(timeoutDiv, document.body.firstChild);
            const timeoutInput = document.getElementById('rotationTimeoutInput');
            timeoutInput.addEventListener('change', function() {
                rotationTimeoutMinutes = Math.max(1, parseInt(timeoutInput.value, 10) || 3);
                resetRotationTimeout();
            });
        });

        function resetRotationTimeout() {
            if (rotationTimeoutId) clearTimeout(rotationTimeoutId);
            rotationTimeoutId = setTimeout(() => {
                if (!rotationActive) {
                    rotationActive = true;
                    triggerRotationColoring();
                }
            }, rotationTimeoutMinutes * 60 * 1000);
        }

        function triggerRotationColoring() {
            // Colorear con imagen rotatoria (no wallpaper.jpg) Y asegurar rotaciÃ³n
            if (window.socket && window.socket.connected) {
                window.socket.emit('activateBrushRevealColoring');
                console.log('ğŸ”„ Modo rotaciÃ³n activado: coloreando con imagen rotatoria');
            }
            // TambiÃ©n asegurar que la auto-rotaciÃ³n estÃ© corriendo
            ensureAutoRotationRunning();
        }

        // Iniciar rotaciÃ³n al cargar
    // Deshabilitado autostart para no interferir con la rotaciÃ³n de patrones
    // document.addEventListener('DOMContentLoaded', function() {
    //     rotationActive = true;
    //     triggerRotationColoring();
    //     resetRotationTimeout();
    // });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'a' || e.key === 'A') {
                e.preventDefault();
                // Solo cambiar imagen a rosa, sin capturar wallpaper
                if (window.socket && window.socket.connected) {
                    window.socket.emit('selectImage', { image: 'pink' });
                }
                console.log('ğŸ…°ï¸ Tecla A: cambiar imagen a rosa (sin capturar wallpaper)');
            } else if (e.key === '1') {
                e.preventDefault();
                console.log('1ï¸âƒ£ *** Tecla 1 recibida: iniciando captura de screen/1...');
                if (window.socket && window.socket.connected) {
                    executeScreenCapture();
                } else {
                    console.error('âŒ Socket no conectado - no se puede iniciar captura');
                }
            }
        });

    // executeUpdateProcess eliminado: la tecla A ya no captura wallpaper

        function createFeedback(text, color) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                min-width: 250px;
                text-align: center;
            `;
            feedback.textContent = text;
            document.body.appendChild(feedback);
            return feedback;
        }

        function updateFeedback(feedback, text, color) {
            feedback.textContent = text;
            feedback.style.background = color;
        }

        async function executeScreenCapture() {
            try {
                // Mostrar feedback visual inicial
                const feedback = createFeedback('ğŸ”„ Paso 1/3: Iniciando captura...', '#007bff');
                
                // PASO 1: Esperar 4 segundos
                console.log('â³ *** PASO 1/3 *** Esperando 4 segundos...');
                updateFeedback(feedback, 'â³ Paso 1/3: Esperando 4 segundos...', '#ffc107');
                await new Promise(resolve => setTimeout(resolve, 4000));
                
                // PASO 2: Recargar screen/1
                console.log('ğŸ”„ *** PASO 2/3 *** Recargando screen/1...');
                updateFeedback(feedback, 'ğŸ”„ Paso 2/3: Recargando screen/1...', '#17a2b8');
                window.socket.emit('reloadScreen', { screenId: 1 });
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // PASO 3: Capturar y guardar como wallpaper.jpg (6480x3840)
                console.log('ğŸ“¸ *** PASO 3/3 *** Capturando screen/1 â†’ wallpaper.jpg (6480x3840)...');
                updateFeedback(feedback, 'ğŸ“¸ Paso 3/3: Capturando como wallpaper.jpg...', '#28a745');
                window.socket.emit('requestCanvasCaptureFromScreen', { 
                    screenId: 1,
                    saveAs: 'wallpaper.jpg',
                    resolution: { width: 6480, height: 3840 }
                });
                
                // Esperar confirmaciÃ³n del servidor
                await new Promise((resolve) => {
                    const timeout = setTimeout(() => {
                        console.warn('âš ï¸ Timeout esperando captura; continuando');
                        updateFeedback(feedback, 'âš ï¸ Timeout - captura completada', '#ffc107');
                        setTimeout(() => feedback.remove(), 3000);
                        resolve();
                    }, 10000);
                    
                    window.socket.once('canvasSaved', (data) => {
                        clearTimeout(timeout);
                        if (data?.success) {
                            console.log('âœ… *** CONFIRMACIÃ“N *** wallpaper.jpg guardado exitosamente:', data);
                            updateFeedback(feedback, 'âœ… wallpaper.jpg guardado exitosamente!', '#28a745');
                        } else {
                            console.error('âŒ Error al guardar wallpaper.jpg:', data);
                            updateFeedback(feedback, 'âŒ Error al guardar wallpaper.jpg', '#dc3545');
                        }
                        setTimeout(() => feedback.remove(), 3000);
                        resolve();
                    });
                });
                
                console.log('âœ… *** PROCESO COMPLETADO *** Captura de tecla 1 finalizada');
                
            } catch (error) {
                console.error('âŒ Error en executeScreenCapture:', error);
                const feedback = createFeedback('âŒ Error en captura', '#dc3545');
                setTimeout(() => feedback.remove(), 3000);
            }
        }
        
        // Limpiar interval al cerrar
        window.addEventListener('beforeunload', () => {
            if (connectionCheckInterval) clearInterval(connectionCheckInterval);
            if (rotationInterval) clearInterval(rotationInterval);
        });

        // ==============================
        // SLIDESHOW CONTROLS
        // ==============================

        function initializeSlideshowControls() {
            // Slideshow Brush 3
            setupSlideshowControls(3, 'slideshow/3');
            
            // Slideshow Brush 7 
            setupSlideshowControls(7, 'slideshow/4');
        }

        function setupSlideshowControls(brushId, folder) {
            const enabled = document.getElementById(`slideshow${brushId}Enabled`);
            const width = document.getElementById(`slideshow${brushId}Width`);
            const height = document.getElementById(`slideshow${brushId}Height`);
            const x = document.getElementById(`slideshow${brushId}X`);
            const y = document.getElementById(`slideshow${brushId}Y`);
            const interval = document.getElementById(`slideshow${brushId}Interval`);
            const shadowWidth = document.getElementById(`slideshow${brushId}ShadowWidth`);

            // Event listeners para actualizar valores en tiempo real
            enabled.addEventListener('change', () => updateSlideshowConfig(brushId));
            width.addEventListener('input', (e) => {
                document.getElementById(`slideshow${brushId}WidthValue`).textContent = e.target.value + 'px';
                updateSlideshowConfig(brushId);
            });
            height.addEventListener('input', (e) => {
                document.getElementById(`slideshow${brushId}HeightValue`).textContent = e.target.value + 'px';
                updateSlideshowConfig(brushId);
            });
            x.addEventListener('input', (e) => {
                document.getElementById(`slideshow${brushId}XValue`).textContent = e.target.value + 'px';
                updateSlideshowConfig(brushId);
            });
            y.addEventListener('input', (e) => {
                document.getElementById(`slideshow${brushId}YValue`).textContent = e.target.value + 'px';
                updateSlideshowConfig(brushId);
            });
            interval.addEventListener('input', (e) => {
                document.getElementById(`slideshow${brushId}IntervalValue`).textContent = e.target.value + 'ms';
                updateSlideshowConfig(brushId);
            });
            shadowWidth.addEventListener('input', (e) => {
                document.getElementById(`slideshow${brushId}ShadowWidthValue`).textContent = e.target.value + 'px';
                updateSlideshowConfig(brushId);
            });
        }

        function updateSlideshowConfig(brushId) {
            const config = {
                enabled: document.getElementById(`slideshow${brushId}Enabled`).checked,
                width: parseInt(document.getElementById(`slideshow${brushId}Width`).value),
                height: parseInt(document.getElementById(`slideshow${brushId}Height`).value),
                x: parseInt(document.getElementById(`slideshow${brushId}X`).value),
                y: parseInt(document.getElementById(`slideshow${brushId}Y`).value),
                interval: parseInt(document.getElementById(`slideshow${brushId}Interval`).value),
                shadowWidth: parseInt(document.getElementById(`slideshow${brushId}ShadowWidth`).value),
                folder: brushId === 3 ? '3' : '4'
            };

            // Enviar configuraciÃ³n al servidor
            fetch(`/api/slideshow/${brushId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                console.log(`ğŸ“º ConfiguraciÃ³n de slideshow ${brushId} actualizada:`, config);
            })
            .catch(error => {
                console.error('Error actualizando slideshow:', error);
            });
        }
    </script>
    <script src="js/control.js?v=3"></script>
</body>
</html>
