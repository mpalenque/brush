<!DOCTYPE html>
<html>
<head>
    <title>Test Rotaci√≥n - Brush Reveal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffe6e6; }
        .success { background: #e6ffe6; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        .on { background: #28a745; color: white; }
        .off { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <h1>üß™ Test de Rotaci√≥n Autom√°tica</h1>
    
    <div>
        <h2>Controles</h2>
        <button id="testBtn" class="off">üîÑ Iniciar Test de Rotaci√≥n</button>
        <button id="checkBtn">üîç Verificar Conexiones</button>
    </div>
    
    <div>
        <h2>Estado de Conexi√≥n</h2>
        <div id="connectionLog" class="log">Iniciando...</div>
    </div>
    
    <div>
        <h2>Logs de Eventos</h2>
        <div id="eventLog" class="log">Esperando eventos...</div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        let rotationActive = false;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'log error' : type === 'success' ? 'log success' : 'log';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function updateConnectionStatus(status) {
            const div = document.getElementById('connectionLog');
            div.textContent = status;
            div.className = status.includes('‚úÖ') ? 'log success' : status.includes('‚ùå') ? 'log error' : 'log';
        }
        
        // Inicializar WebSocket
        function initSocket() {
            socket = io();
            
            socket.on('connect', () => {
                updateConnectionStatus('‚úÖ Conectado al servidor');
                socket.emit('registerScreen', { screenId: 0, type: 'control' });
                log('üîå Test conectado como control', 'success');
            });
            
            socket.on('disconnect', () => {
                updateConnectionStatus('‚ùå Desconectado del servidor');
                log('üîå Test desconectado', 'error');
            });
        }
        
        // Test de rotaci√≥n
        document.getElementById('testBtn').addEventListener('click', function() {
            if (!rotationActive) {
                // Iniciar rotaci√≥n
                if (socket && socket.connected) {
                    socket.emit('startPatternRotation', {
                        patterns: ['amarillo', 'azul', 'rojo'],
                        interval: 10000 // 10 segundos para test r√°pido
                    });
                    log('üì° Comando startPatternRotation enviado (intervalo: 10s)', 'success');
                    this.textContent = '‚èπÔ∏è Detener Test de Rotaci√≥n';
                    this.className = 'on';
                    rotationActive = true;
                } else {
                    log('‚ùå Socket no conectado', 'error');
                }
            } else {
                // Detener rotaci√≥n
                if (socket && socket.connected) {
                    socket.emit('stopPatternRotation');
                    log('üì° Comando stopPatternRotation enviado', 'success');
                    this.textContent = 'üîÑ Iniciar Test de Rotaci√≥n';
                    this.className = 'off';
                    rotationActive = false;
                } else {
                    log('‚ùå Socket no conectado', 'error');
                }
            }
        });
        
        // Verificar conexiones
        document.getElementById('checkBtn').addEventListener('click', function() {
            if (socket && socket.connected) {
                log('üîç Socket conectado correctamente', 'success');
                socket.emit('getConnectedClients'); // Vamos a crear este evento
            } else {
                log('‚ùå Socket no conectado', 'error');
            }
        });
        
        // Inicializar
        initSocket();
        log('üöÄ Test iniciado - esperando conexi√≥n...');
    </script>
</body>
</html>
